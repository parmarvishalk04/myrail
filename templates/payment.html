{% extends 'base.html' %}
{% block title %}Payment - BlueRail{% endblock %}

{% block extra_head %}
<style>
  /* Payment Page Specific Styles */
  .payment-container {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 0 1rem;
  }

  .payment-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-top: 1.5rem;
  }

  .payment-card {
    background: var(--card-bg);
    border-radius: var(--radius);
    padding: 1.75rem;
    box-shadow: 0 4px 20px var(--shadow);
    border: 1px solid var(--border);
    margin-bottom: 1.5rem;
  }

  .payment-card h3 {
    margin-bottom: 1.25rem;
    color: var(--primary-dark);
    font-size: 1.375rem;
  }

  .booking-summary p {
    margin-bottom: 0.75rem;
    color: var(--text);
    line-height: 1.5;
  }

  .booking-summary strong {
    color: var(--text);
    font-weight: 600;
  }

  .total-amount {
    margin-top: 1.5rem;
    padding-top: 1.25rem;
    border-top: 2px solid var(--border);
  }

  .total-amount p {
    font-size: 1.5rem;
    font-weight: 800;
    color: var(--primary-dark);
    margin: 0;
  }

  .form-row {
    margin-bottom: 1.25rem;
  }

  .form-row label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--text);
    font-size: 0.9375rem;
  }

  .input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    font-size: 1rem;
    transition: var(--transition);
    background-color: white;
  }

  .input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.15);
  }

  .input-error {
    border-color: var(--danger) !important;
    background-color: rgba(244, 67, 54, 0.05) !important;
  }

  .form-errors {
    color: var(--danger);
    font-size: 0.8125rem;
    margin-top: 0.5rem;
    padding: 0.5rem 0.75rem;
    background-color: rgba(244, 67, 54, 0.08);
    border-radius: var(--radius-sm);
    border-left: 3px solid var(--danger);
  }

  .form-errors div {
    margin: 0.25rem 0;
  }

  .expiry-cvv {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1rem;
  }

  .payment-methods {
    margin-top: 1.5rem;
    padding: 1rem;
    background: var(--muted);
    border-radius: var(--radius-sm);
    font-size: 0.875rem;
    color: var(--text-muted);
    line-height: 1.5;
  }

  .payment-methods p {
    margin: 0 0 0.5rem 0;
  }

  .payment-methods ul {
    margin: 0.5rem 0 0 1.25rem;
    padding: 0;
  }

  .payment-methods li {
    margin-bottom: 0.25rem;
  }

  /* Responsive Styles */
  @media (max-width: 992px) {
    .payment-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    
    .payment-card {
      padding: 1.5rem;
    }
  }

  @media (max-width: 768px) {
    .payment-container {
      padding: 0 0.75rem;
    }
    
    .expiry-cvv {
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }
    
    .btn-pay {
      width: 100%;
      padding: 1rem;
      font-size: 1.1rem;
    }
  }

  @media (max-width: 480px) {
    .payment-card {
      padding: 1.25rem;
      border-radius: var(--radius-sm);
    }
    
    .payment-card h3 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }
    
    .total-amount p {
      font-size: 1.375rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="payment-container">
  <h2>Complete Payment</h2>
  
  <div class="payment-grid">
    <!-- Booking Summary -->
    <div>
      <div class="payment-card">
        <h3>Booking Summary</h3>
        <div class="booking-summary">
          <p>
            <strong>Train:</strong><br>
            <span>{{ booking.train.name }} â€¢ {{ booking.train.number }}</span>
          </p>
          <p>
            <strong>Route:</strong><br>
            <span>{{ booking.train.from_station }} â†’ {{ booking.train.to_station }}</span>
          </p>
          <p>
            <strong>Travel Date:</strong><br>
            <span>{{ booking.travel_date.strftime('%B %d, %Y') if booking.travel_date else 'N/A' }}</span>
          </p>
          <p>
            <strong>Passenger:</strong><br>
            <span>{{ booking.passenger_name }} ({{ booking.passenger_age }} years, {{ booking.passenger_gender }})</span>
          </p>
          <p>
            <strong>Class:</strong><br>
            <span>{{ booking.seat_class }}</span>
          </p>
          <div class="total-amount">
            <p>Total Amount: â‚¹ {{ "%.2f"|format(booking.fare) }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Form -->
    <div>
      <div class="payment-card">
        <h3>Payment Details</h3>
        <form method="post" novalidate id="paymentForm">
          {{ form.hidden_tag() }}
          
          <div class="form-row">
            {{ form.card_name.label }}
            {{ form.card_name(
                class_='input',
                placeholder='Name as on card',
                autocomplete='cc-name',
                required=True,
                maxlength="50"
            ) }}
            {% if form.card_name.errors %}
              <div class="form-errors">
                {% for error in form.card_name.errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="form-row">
            {{ form.card_number.label }}
            {{ form.card_number(
                class_='input card-number',
                placeholder='1234 5678 9012 3456',
                autocomplete='cc-number',
                maxlength='19',
                required=True,
                inputmode='numeric',
                pattern='[0-9\s]{13,19}'
            ) }}
            {% if form.card_number.errors %}
              <div class="form-errors">
                {% for error in form.card_number.errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="expiry-cvv">
            <div class="form-row">
              {{ form.expiry.label }}
              {{ form.expiry(
                  class_='input expiry-date',
                  placeholder='MM/YY',
                  autocomplete='cc-exp',
                  maxlength='5',
                  required=True,
                  pattern='(0[1-9]|1[0-2])\/([0-9]{2})',
                  title='Please enter a valid expiry date in MM/YY format'
              ) }}
              {% if form.expiry.errors %}
                <div class="form-errors">
                  {% for error in form.expiry.errors %}
                    <div>{{ error }}</div>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <div class="form-row">
              {{ form.cvv.label }}
              {{ form.cvv(
                  class_='input cvv',
                  placeholder='CVV',
                  autocomplete='cc-csc',
                  maxlength='4',
                  required=True,
                  inputmode='numeric',
                  pattern='[0-9]{3,4}',
                  title='Please enter a 3 or 4 digit CVV'
              ) }}
              {% if form.cvv.errors %}
                <div class="form-errors">
                  {% for error in form.cvv.errors %}
                    <div>{{ error }}</div>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </div>

          <div class="form-row" style="margin-top: 2rem;">
            <button type="submit" class="btn btn-primary btn-pay">
              Pay â‚¹{{ "%.2f"|format(booking.fare) }}
            </button>
          </div>
        </form>
        
        <div class="payment-methods">
          <p><strong>Secure Payment:</strong></p>
          <ul>
            <li>Your payment information is encrypted and secure</li>
            <li>We support all major credit and debit cards</li>
            <li>100% secure payment processing</li>
          </ul>
        </div>
        <strong>ðŸ”’ Secure Payment:</strong> This is a demo application. No real card processing is performed. In production, this would integrate with a secure payment gateway.
      </div>
    </div>
  </div>
</div>

<script>
  // Format card number input
  document.addEventListener('DOMContentLoaded', function() {
    const cardNumber = document.querySelector('input[name="card_number"]');
    if (cardNumber) {
      cardNumber.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\s+/g, '');
        value = value.replace(/(.{4})/g, '$1 ').trim();
        e.target.value = value;
      });
    }

    // Format expiry input
    const expiry = document.querySelector('input[name="expiry"]');
    if (expiry) {
      expiry.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length >= 2) {
          value = value.substring(0, 2) + '/' + value.substring(2, 4);
        }
        e.target.value = value;
      });
    }
  });
</script>
{% endblock %}